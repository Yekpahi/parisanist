{% extends '../main.html' %} {% load static %} {% block title %} 
{% for cart_item in cart_items %} {{cart_item.product.product_name}} - {% endfor %} 
{% endblock %} {% block content %}
<link rel="stylesheet" href=" {% static 'assets/css/cart/cart.css' %}" />

<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
/>
<link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css
">

<section class="main" id="cartList">
  <!-- cart label -->
  <p class="shopping-cart-title">Shopping cart {{totalitems}}</p>
  <!-- End cart label -->



  <div class="scroll">
    
   
    {% for product_id,item in cart_data.items %}
    <!-- One cart informations -->
    <div class="main-cart">
      <div class="card-container">
        <!-- cart image -->

        <div class="image-container">
          <!-- Selection the one image which is feature -->

          <img src="{{item.image}}" alt="" />
     
          <!-- Selection the one image which is feature -->
        </div>
        <!-- End cart image -->

        <!-- Right informations -->
        <div class="right-infos">
          <!-- Price and product name -->
          <ul class="name-and-price">
            <li class="product-name">
              <a href="{{ cart_item.product.get_url }}">{{item.title}}</a>
            </li>
            <li class="product-price">{{item.price}}</li>
            <li>$ {% widthratio item.price 1 item.qty %}</li>
            <li>Rs. {{total_amt}}</li>
          </ul>
          <!-- End Price and product name -->
          <!-- color and size -->
          <ul class="color-and-size">
         
            <li>
              {{item.color}}
            </li>

          </ul>
          <!-- End color and size -->
          <!-- Quantity remove add and delete cart -->
          <ul class="qty-remove-add-delete">
            <li class="remove-cart">
              <a
                href=""
                ><span class="material-symbols-outlined delete-item"> remove </span></a
              >
            </li>
            <li class="quantity">qty :{{item.qty}}</li>
            <li class="add-cart">
              <input type="number" class="product-qty-{{product_id}}" value="{{item.qty}}" style="vertical-align: bottom;" />
              <button class="btn btn-sm btn-primary update-item" data-item="{{product_id}}"><i class="fa fa-sync"></i></button>
            </li>
            <li class="delete delete-item" data-item="{{product_id}}">
              <a
                href=""
              >
                <img src="{% static 'assets/imgs/trash.png' %}" alt="" />
              </a>
            </li>
          </ul>
          <!-- End Quantity remove add and delete cart -->
        </div>
        <!-- End Right informations -->
      </div>
    </div>
    <!-- End One cart informations -->
    {% endfor %}
   
      
    
  </div>
  <!-- cart others informations -->
  <div class="others-infos-main">
    <div class="others-infos-container">
      <div class="total-and-tva">
        <ul>
          <li class="total-text">Total</li>
          <li class="" the-total>{{ grand_total }} Eu</li>
        </ul>
        <p class="tva-infos">
          A VAT of {{tax}} Eur is included in the total price
        </p>
      </div>
      <div class="checkout-button">
        <a href="{% url 'checkout' %}"><span>Check out</span></a>
      </div>
      <div class="continue-shop">
        <a href="{% url 'store' %}"><span>Continue to shop</span></a>
      </div>
      <div class="payment-infos">
        <p>Secure payment</p>
        <ul>
          <li class="credit-cart">
            <img src="{% static 'assets/imgs/credit-cart.png' %}" alt="" />
          </li>
          <li class="paypal">
            <img src="{% static 'assets/imgs/paypal.png' %}" alt="" />
          </li>
        </ul>
      </div>
    </div>
  </div>

</section>

<script>
  $(document).ready(function(){
    console.log("salut")
    // Product Variation
    $(".choose-size").hide();

    //Show size according to selected color
    $(".choose-color").on('click', function(){
      $(".choose-size").removeClass('active');
      $(".choose-color").removeClass('focused');
      $(this).addClass("focused");

      var _color = $(this).attr("data-color");

      $(".choose-size").hide();
      $(".color"+ _color).show();
      $(".color"+ _color).first().addClass('activate');
    });

    // End

    // Show the first selected color
    $(".choose-color").first().addClass('focused');
    var _color = $(".choose-color").first().attr('data-color');

    $(".color"+ _color).show();
    $(".color"+ _color).first().addClass('activate');

  // Add to cart
	$(document).on('click',".add-to-cart",function(){
    var _vm=$(this);
		var _index=_vm.attr('data-index');
		var _qty=$(".product-qty-"+_index).val();
    var _productImage=$(".product-image-"+_index).val();
    var _productColor=$(".product-color-"+_index).val();
		var _productId=$(".product-id-"+_index).val();
		var _productTitle=$(".product-title-"+_index).val();
		var _productPrice=$(".product-price-"+_index).text();
    console.log(_productImage,_productTitle, _productColor)
		// AjaxuctPrice=$(".product-price-"+_index).text();
		// Ajax
		$.ajax({
			url:'{% url "add_to_cart" %}',
			data:{
				'id':_productId,
        'image':_productImage,
				'qty':_qty,
				'title':_productTitle,
				'price':_productPrice, 
        'color':_productColor
			},
			dataType:'json',
			beforeSend:function(){
				_vm.attr('disabled',true);
			},
			success:function(res){
        console.log("succes")
				$(".cart-list").text(res.totalitems);
				_vm.attr('disabled',false);
			}
		});
		// End
	});
	// End
  
	// Delete item from cart
	$(document).on('click','.delete-item',function(){
		var _pId=$(this).attr('data-item');
		var _vm=$(this);
		// Ajax
		$.ajax({
			url:'{% url "delete_from_cart" %}',
			data:{
				'id':_pId,
			},
			dataType:'json',
			beforeSend:function(){
				_vm.attr('disabled',true);
			},
			success:function(res){
				$(".cart-list").text(res.totalitems);
				_vm.attr('disabled',false);
				$("#cartList").html(res.data);
			}
		});
		// End
	});

	// Update item from cart
	$(document).on('click','.update-item',function(){
		var _pId=$(this).attr('data-item');
		var _pQty=$(".product-qty-"+_pId).val();
		var _vm=$(this);
		// Ajax
		$.ajax({
			url:'{% url "update_cart" %}',
			data:{
				'id':_pId,
				'qty':_pQty
			},
			dataType:'json',
			beforeSend:function(){
				_vm.attr('disabled',true);
			},
			success:function(res){
				// $(".cart-list").text(res.totalitems);
				_vm.attr('disabled',false);
				$("#cartList").html(res.data);
			}
		});
		// End
	});
    //End

  });
</script>
<!-- End add to cart  -->
<!-- End add to cart  -->
{% endblock content %}
